# QA Agent 测试指南

## 环境准备

### 已安装组件
✅ Midscene.js (@midscene/web)
✅ Playwright
✅ 配置文件 (midscene.config.js)
✅ 环境变量 (.env)
✅ 测试脚本模板

## 快速开始

### 1. 运行快速测试
```bash
npm run test:quick
```

### 2. 运行 Web 测试
```bash
npm run test:web
```

### 3. 查看测试报告
```bash
npm run report
```

## 测试工作流

### 接收测试任务
从 Dev Agent 接收项目后：

1. **分析测试需求**
   - 识别功能模块
   - 列出测试场景
   - 设计测试用例

2. **编写测试脚本**
   - 使用 `scripts/web-test-template.js` 作为模板
   - 用自然语言描述测试步骤
   - 添加断言验证

3. **执行测试**
   ```bash
   npm test
   ```

4. **生成报告**
   - 截图保存在 `test-reports/`
   - 测试报告在 `test-reports/report.html`

5. **反馈 Bug**
   - 记录问题描述
   - 附上截图和日志
   - 反馈给 Dev Agent

## API 速查

### 交互 API
```javascript
// 执行操作（自然语言）
await page.aiAct('点击登录按钮，输入用户名和密码');

// 点击
await page.aiTap('登录按钮');

// 输入
await page.aiType('用户名', 'admin');

// 选择
await page.aiSelect('下拉框', '选项');

// 等待
await page.aiWaitFor('元素出现');
```

### 数据提取 API
```javascript
// 提取字符串
const text = await page.aiQuery('string, 页面标题');

// 提取数组
const items = await page.aiQuery('string[], 列表项');

// 提取对象
const data = await page.aiQuery('{ name: string, age: number }, 用户信息');
```

### 断言 API
```javascript
// 断言
await page.aiAssert('页面包含"成功"文字');
await page.aiAssert('按钮可点击');

// 布尔检查
const isVisible = await page.aiBoolean('元素是否可见');
```

## 常见测试场景

### 1. 登录测试
```javascript
test('登录测试', async ({ page }) => {
  await page.goto('https://app.com/login');
  await page.aiAct('输入用户名 admin 和密码 123456，点击登录');
  await page.aiAssert('页面显示欢迎信息');
});
```

### 2. 表单测试
```javascript
test('表单提交', async ({ page }) => {
  await page.goto('https://app.com/form');
  await page.aiType('姓名', '张三');
  await page.aiType('电话', '13800138000');
  await page.aiTap('提交');
  await page.aiAssert('显示提交成功');
});
```

### 3. 列表操作
```javascript
test('列表筛选', async ({ page }) => {
  await page.goto('https://app.com/list');
  await page.aiSelect('状态筛选', '已完成');
  const items = await page.aiQuery('string[], 筛选后的列表项');
  expect(items.length).toBeGreaterThan(0);
});
```

## 调试技巧

### 1. 启用截图
测试失败时自动截图保存在 `test-reports/`

### 2. 慢速执行
在 `.env` 中设置：
```
SLOW_MO=1000
```

### 3. 非无头模式
在 `.env` 中设置：
```
HEADLESS=false
```

### 4. 查看日志
测试运行时会在控制台输出详细日志

## 注意事项

1. **API Key 安全**：不要将 `.env` 文件提交到 Git
2. **测试数据**：使用测试账号，不要用生产数据
3. **并发限制**：豆包 API 有调用频率限制，注意控制并发
4. **缓存清理**：测试数据变化时，清理 Midscene 缓存

## 与 Dev Agent 协作

### 接收任务
Dev Agent 完成开发后，会发送测试请求，包含：
- 项目地址
- 测试需求
- 验收标准

### 反馈 Bug
发现问题时，发送给 Dev Agent：
- 问题描述
- 重现步骤
- 截图证据
- 优先级（P0-P3）

---

*最后更新: 2026-02-27*
